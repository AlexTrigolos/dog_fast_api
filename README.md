# Автор: Алексей Триголос

# dog_fast_api

## Запуск приложения

Для запуска необходимо прописать в консоль `uvicorn main:app --reload`, после чего развернется приложение на localhost
с портом 8000. (ну или uvicorn main:app --host 127.0.0.1 --port 5555 как требовалось в одном из предыдущих заданиях)

## Запросы

### GET /

Ничего не было понятно, просто возвращает строку, в моем случае `OK`, символизирующее статус работы сервера.

### POST /post

На вход не получает ничего. Создает новый timestamp в локальной базе данных с идентификатором и передает созданное на выход.

### GET /dog

На вход получаем в параметры вид собаки, один из 3 допустимых. Ищем всех собак такого вида и возвращаем их в ответе.

### POST /dog

На вход получаем новую собаку. Если её идентификатор уникален, то создаем и возвращаем, иначе кидаем ошибку.

### GET /dog/{pk}

На вход получаем идентификатор. Если собака с таким идентификатором отсутствует, то кидаем ошибку, иначе возвращаем найденную собаку.

### PATCH /dog/{pk}

На вход получаем идентификатор и новые данные собаки. Если собака с таким идентификатором не найдена, то кидаем ошибку. Если новый идентификатор не равняется старому и уже существует собака с тем же идентификатором, то кидаем ошибку. Иначе удаляем старую собаку, а на её месте создаем новую (так как нам не важны старые поля и состояние или что-либо ещё, можем позволить).

# @DogFastApiBot (Telegram)

## О боте

Бот создан с помощью библиотеки aiogram. Для старта необходимо написать команду `/start`.
После чего будут доступны кнопки с командами для общения с запущенным FastAPI сервером.

При выборе одной из команд будет дан ответ от сервера либо запрошены дополнительные данные для обращения к серверу.
При введении дополнительных данных (если необходимо) запрос отправляется на сервер и после получения ответа ботом, он возвращает вам результат.

1. Если всё хорошо, то информацию от сайта в моей интерпретации как это должно выглядеть.
2. Если же произошла ошибка (не работает сервер или еще что-то, что от вас не зависит), то будет сырой ответ от сервера.
3. Если же Вы введете неверные данные (скорее всего не по шаблону), то просто запрос не обрабатывается.
Никакие состояния не меняются, можете сразу пытаться изменить ответ в новом сообщении.

# Docker, docker-compose

### Основное

Было разделено по зонам ответственности на бота и апишку.
Каждая часть имеет собственный `requirements.txt` и свой `Dockerfile`.
Кроме этого создан общий `docker-compose.yml`

### API

Образ апишки можно найти на docker hub как `alextrigolosvlg/dog_fast_api`.
Основные изменения над `python:3.11-slim` заключаются в том, что были добавлены свои requirements и прописана команда для запуска FastAPI используя uvicorn с портом 5555.
Можно запустить как `docker run -p 5555:5555 alextrigolosvlg/dog_fast_api:v1` в таком случае будет доступен локально на 5555 порту.

### Bot

Образ бота лежит на docker hub как `alextrigolosvlg/dog_fast_api_bot`.
Основные изменения над `python:3.11-slim` заключаются в том, что были добавлены свои requirements и прописана команда для запуска бота.
Правда запуск бота без api практически бессмысленные, ведь он каждый раз обращается к апишке.

### docker-compose

Для запуска необходимо создать файл `.env` и записать в него `BOT_TOKEN=<BOT_TOKEN>`.
После чего прописав `docker-compose up` можно запустить контейнер сразу с образом ранее описанных апишки и бота.
Сам же контейнер имеет в себе 2 образа.
1. Апишка с пробросом портов и постоянным рестартом.
2. Бот с рестартом и переменными среды окружения (BOT_TOKEN и BOT_API_URL, в котором ссылка на апишку).
